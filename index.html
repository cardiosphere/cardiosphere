<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cardiosphere.in ( The Way to a Healthy Heart ) - Expert Medical and Cardiac Care (Diagnostics |  Clinic |  Pharmacy) </title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Custom styles for a clean, professional medical look */
      .shadow-medical {
        box-shadow: 0 10px 30px rgba(150, 45, 45, 0.1);
      }
      .text-inter {
        font-family: "Inter", sans-serif;
      }
      .icon-hover-effect {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      .icon-hover-effect:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(185, 28, 28, 0.2);
      }
      /* Gradient for the Hero Section */
      .hero-gradient {
        background: linear-gradient(
          145deg,
          #7f1d1d 0%,
          #dc2626 70%,
          #991b1b 100%
        );
      }
      /* Hide all main content sections initially, only show the home section */
      main > section {
        display: none;
      }
      #home {
        display: block;
      }
    </style>
  </head>
  <body class="text-inter bg-gray-50">
    <!-- Appointment Modal (Hidden by Default) -->
    <div
      id="appointment-modal"
      class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4"
      onclick="closeModal(event)"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-lg mx-auto transform transition-all duration-300 scale-100"
        onclick="event.stopPropagation()"
      >
        <div class="p-6">
          <div class="flex justify-between items-start">
            <h2 class="text-2xl font-bold text-red-800">
              Book Your Consultation
            </h2>
            <button
              onclick="closeModal()"
              class="text-gray-400 hover:text-red-500 transition-colors"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M18 6 6 18" />
                <path d="m6 6 12 12" />
              </svg>
            </button>
          </div>
          <form id="appointment-form" class="mt-6 space-y-4">
            <div>
              <label
                for="doctor"
                class="block text-sm font-medium text-gray-700"
                >Select Specialist</label
              >
              <select
                id="doctor"
                name="doctor"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500"
              >
                <option value="Dr. Tutan Das">
                  Dr. Tutan Das (Cardiologist)
                </option>
                <option value="Dr. Manidipa Majumdar">
                  Dr. Manidipa Majumdar (Cardiologist)
                </option>
              </select>
            </div>
            <div>
              <label for="name" class="block text-sm font-medium text-gray-700"
                >Full Name</label
              >
              <input
                type="text"
                id="name"
                name="name"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500"
              />
            </div>
            <div>
              <label for="phone" class="block text-sm font-medium text-gray-700"
                >Phone Number</label
              >
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500"
              />
            </div>
            <div>
              <label for="date" class="block text-sm font-medium text-gray-700"
                >Preferred Date</label
              >
              <input
                type="date"
                id="date"
                name="date"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500"
              />
            </div>
            <div>
              <label
                for="reason"
                class="block text-sm font-medium text-gray-700"
                >Reason for Visit</label
              >
              <textarea
                id="reason"
                name="reason"
                rows="2"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:ring-red-500 focus:border-red-500"
              ></textarea>
            </div>
            <button
              type="submit"
              class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-300"
            >
              Confirm Appointment
            </button>
            <p
              id="submission-message"
              class="text-center text-sm font-medium pt-2 hidden"
            ></p>
          </form>
        </div>
      </div>
    </div>

    <!-- Header & Navigation -->
    <header class="sticky top-0 bg-white shadow-md z-30">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-4"
      >
        <div
          class="flex items-center space-x-2 cursor-pointer"
          onclick="navigate('home')"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#dc2626"
            stroke-width="2.5"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path
              d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
            />
          </svg>
          <h1 class="text-2xl font-extrabold text-red-900">Cardiosphere</h1>
        </div>
        <nav class="hidden md:flex space-x-8 font-medium">
          <a
            href="#"
            onclick="navigate('home')"
            class="text-gray-600 hover:text-red-600 transition-colors"
            >Home</a
          >
          <a
            href="#"
            onclick="navigate('doctors')"
            class="text-gray-600 hover:text-red-600 transition-colors"
            >Our Doctors</a
          >
          <a
            href="#"
            onclick="navigate('services')"
            class="text-gray-600 hover:text-red-600 transition-colors"
            >Services</a
          >
          <a
            href="#"
            onclick="navigate('contact')"
            class="text-gray-600 hover:text-red-600 transition-colors"
            >Contact</a
          >
        </nav>
        <button
          onclick="openModal()"
          class="hidden md:inline-flex px-6 py-2 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors shadow-lg shadow-red-300"
        >
          Book Appointment
        </button>

        <!-- Mobile Menu Button -->
        <button
          id="mobile-menu-button"
          class="md:hidden text-gray-600 hover:text-red-600"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="4" x2="20" y1="12" y2="12" />
            <line x1="4" x2="20" y1="6" y2="6" />
            <line x1="4" x2="20" y1="18" y2="18" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Mobile Menu Drawer -->
    <div
      id="mobile-menu"
      class="hidden md:hidden fixed inset-0 bg-white z-40 p-6 shadow-xl pt-20"
    >
      <nav class="flex flex-col space-y-4 font-semibold">
        <a
          href="#"
          class="text-gray-700 hover:text-red-600 border-b pb-2"
          onclick="navigate('home'); toggleMobileMenu();"
          >Home</a
        >
        <a
          href="#"
          class="text-gray-700 hover:text-red-600 border-b pb-2"
          onclick="navigate('doctors'); toggleMobileMenu();"
          >Our Doctors</a
        >
        <a
          href="#"
          class="text-gray-700 hover:text-red-600 border-b pb-2"
          onclick="navigate('services'); toggleMobileMenu();"
          >Services</a
        >
        <a
          href="#"
          class="text-gray-700 hover:text-red-600 border-b pb-2"
          onclick="navigate('contact'); toggleMobileMenu();"
          >Contact</a
        >
        <button
          onclick="openModal(); toggleMobileMenu();"
          class="mt-4 w-full py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors"
        >
          Book Appointment
        </button>
      </nav>
    </div>

    <main>
      <!-- Hero Section - Updated with Creative Gradient Design -->
      <section
        id="home"
        class="hero-gradient text-white py-16 md:py-24 shadow-inner"
      >
        <div
          class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row items-center gap-12"
        >
          <div class="md:w-1/2">
            <p
              class="text-red-300 text-lg font-medium mb-3 tracking-widest uppercase"
            >
              Cardiosphere Polyclinic
            </p>
            <h2
              class="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight text-white drop-shadow-md"
            >
              Advanced
              <span class="text-red-300">Heart & General</span> Healthcare
            </h2>
            <p class="mt-6 text-xl text-red-100">
              World-class diagnosis and treatment from two dedicated
              Cardiologists, Dr. Tutan Das and Dr. Manidipa Majumdar.
            </p>
            <button
              onclick="openModal()"
              class="mt-8 px-8 py-4 text-lg bg-white text-red-700 font-bold rounded-xl hover:bg-gray-100 transition-all shadow-2xl hover:shadow-red-400"
            >
              Schedule Your Visit
            </button>
          </div>
          <!-- Doctor Tutan Das Photo in Hero Section -->
          <div class="md:w-1/2 flex justify-center">
            <div
              class="w-64 h-64 md:w-80 md:h-80 rounded-full shadow-2xl overflow-hidden border-4 border-white transform hover:scale-105 transition-transform duration-300"
            >
              <img
                src="https://content.jdmagicbox.com/comp/durgapur/h9/9999px343.x343.240206131748.s7h9/catalogue/dr-tutan-das-benachity-durgapur-cardiac-resynchronization-therapy-treatment-services-xnmrmoazhb.jpg"
                alt="Photo of Dr. Tutan Das, Interventional Cardiologist"
                class="w-full h-full object-cover"
                onerror="this.onerror=null; this.src='https://placehold.co/800x800/991b1b/ffffff?text=TD'"
              />
            </div>
          </div>
        </div>
      </section>

      <!-- Doctors Profile Section -->
      <section id="doctors" class="py-16 md:py-24 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 class="text-3xl font-bold text-center text-red-800 mb-12">
            Our Specialist Team
          </h3>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
            <!-- Doctor 1: Dr. Tutan Das (Cardiologist - Red accent) -->
            <div
              class="bg-white rounded-xl p-8 shadow-medical flex flex-col md:flex-row items-center gap-6"
            >
              <div
                class="w-32 h-32 flex-shrink-0 rounded-full border-4 border-red-600 overflow-hidden"
              >
                <!-- Dr. Tutan Das Photo in Profile -->
                <img
                  src="https://content.jdmagicbox.com/comp/durgapur/h9/9999px343.x343.240206131748.s7h9/catalogue/dr-tutan-das-benachity-durgapur-cardiac-resynchronization-therapy-treatment-services-xnmrmoazhb.jpg"
                  alt="Photo of Dr. Tutan Das"
                  class="w-full h-full object-cover"
                  onerror="this.onerror=null; this.src='https://placehold.co/300x300/b91c1c/ffffff?text=TD'"
                />
              </div>
              <div class="text-center md:text-left">
                <h4 class="text-2xl font-bold text-gray-900">Dr. Tutan Das</h4>
                <p class="text-lg font-semibold text-red-600 mb-2">
                  Interventional Cardiologist
                </p>
                <p class="text-sm text-gray-500">
                  DM - Cardiology (AIIMS Bhubaneswar) | MD (Medicine)
                </p>
                <p class="mt-3 text-gray-700">
                  A leading expert in procedures like Angioplasty, Stenting,
                  Pacemaker Implantation, and advanced management of complex
                  heart diseases. Recognized for extensive research and
                  publications.
                </p>
                <button
                  onclick="openModal()"
                  class="mt-4 px-4 py-2 text-sm bg-red-600 text-white font-medium rounded-lg hover:bg-red-700"
                >
                  Book Appointment
                </button>
              </div>
            </div>

            <!-- Doctor 2: Dr. Manidipa Majumdar (Cardiologist - Red accent) -->
            <div
              class="bg-white rounded-xl p-8 shadow-medical flex flex-col md:flex-row items-center gap-6"
            >
              <div
                class="w-32 h-32 flex-shrink-0 rounded-full border-4 border-red-600 overflow-hidden"
              >
                <!-- Dr. Tutan Das Photo in Profile -->
                <img
                  src="https://hlghospital.com/wp-content/uploads/2025/04/dr.-manidipa.jpg"
                  alt="Photo of Dr. Manidipa Majumdar"
                  class="w-full h-full object-cover"
                  onerror="this.onerror=null; this.src='https://placehold.co/300x300/b91c1c/ffffff?text=TD'"
                />
              </div>
              <div class="text-center md:text-left">
                <h4 class="text-2xl font-bold text-gray-900">
                  Dr. Manidipa Majumdar
                </h4>
                <p class="text-lg font-semibold text-red-600 mb-2">
                  Interventional Cardiologist
                </p>
                <p class="text-sm text-gray-500">
                 DM | MD | Specialization in Cardiac Diseases & Diagnostics
                </p>
                <p class="mt-3 text-gray-700">
                  Specializes in comprehensive cardiac diagnostics, non-invasive
                  procedures (Echo, TMT), and chronic cardiovascular disease
                  management, providing integrated medical support to all
                  patients.
                </p>
                <button
                  onclick="openModal()"
                  class="mt-4 px-4 py-2 text-sm bg-red-600 text-white font-medium rounded-lg hover:bg-red-700"
                >
                  Book Appointment
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Services Section -->
      <section id="services" class="py-16 md:py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <h3 class="text-3xl font-bold text-center text-red-800 mb-12">
            Detailed Services Offered
          </h3>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Cardiology Services -->
            <div
              class="p-6 rounded-xl bg-red-50 shadow-sm border-l-4 border-red-600"
            >
              <h4
                class="text-xl font-bold text-red-800 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-6 h-6"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"
                  />
                </svg>
                Advanced Cardiac Care
              </h4>
              <ul class="list-disc list-inside space-y-1 text-gray-700 ml-4">
                <li>Coronary Angioplasty & Stenting</li>
                <li>Pacemaker & ICD Implantation</li>
                <li>Cardiac Electrophysiology Consultation</li>
                <li>Treatment for Heart Failure & Arrhythmias</li>
                <li>Valvular Heart Disease Management</li>
              </ul>
            </div>

            <!-- Diagnostic Services -->
            <div
              class="p-6 rounded-xl bg-red-50 shadow-sm border-l-4 border-red-600"
            >
              <h4
                class="text-xl font-bold text-red-800 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-6 h-6"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path
                    d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.76l1.54-9C23.53 10.56 21.58 9 19 9h-5Z"
                  />
                  <path d="M12 22h1v-7a5 5 0 0 0-5-5L8 5" />
                </svg>
                Non-Invasive Diagnostics
              </h4>
              <ul class="list-disc list-inside space-y-1 text-gray-700 ml-4">
                <li>2D Echocardiography (2D Echo)</li>
                <li>Treadmill Test (TMT) / Stress Test</li>
                <li>Holter & Ambulatory BP Monitoring</li>
                <li>Electrocardiogram (ECG)</li>
                <li>PFT (Pulmonary Function Test)</li>
              </ul>
            </div>

            <!-- General Polyclinic Services -->
            <div
              class="p-6 rounded-xl bg-red-50 shadow-sm border-l-4 border-red-600"
            >
              <h4
                class="text-xl font-bold text-red-800 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-6 h-6"
                  xmlns="http://www.w3.org/2000/svg"
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M12 21.5V16" />
                  <path d="M16 16h-8" />
                  <path d="M16 16v-3a4 4 0 0 0-8 0v3" />
                  <path
                    d="M12 12c-1 0-2-.5-2-1.5V7a2 2 0 1 1 4 0v3.5c0 1-.5 1.5-2 1.5Z"
                  />
                  <path d="M12 12V2" />
                </svg>
                Chronic Condition Management
              </h4>
              <ul class="list-disc list-inside space-y-1 text-gray-700 ml-4">
                <li>Diabetes Mellitus Management</li>
                <li>Hypertension (BP) Control</li>
                <li>Thyroid & Endocrine Disorders</li>
                <li>Acute & Chronic Disease Consultation</li>
                <li>Infectious Disease Treatment</li>
              </ul>
            </div>
          </div>
          <div class="mt-10 text-center">
            <button
              onclick="openModal()"
              class="px-6 py-3 text-lg bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition-colors shadow-lg"
            >
              View Doctor Schedules & Book
            </button>
          </div>
        </div>
      </section>

      <!-- Contact & Footer -->
      <footer id="contact" class="bg-red-900 text-white py-12">
        <div
          class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid grid-cols-1 md:grid-cols-3 gap-10"
        >
          <!-- Col 1: Clinic Info -->
          <div>
            <h4 class="text-xl font-bold text-red-300 mb-4">
              Cardiosphere Polyclinic (Diagnostics |  Clinic |  Pharmacy)
            </h4>
            <p class="text-red-200">
              Integrated medical care provided by experts in Cardiology and
              General Medicine.
            </p>
            <div class="flex items-center space-x-2 mt-4">
              <svg
                class="w-5 h-5 text-yellow-400"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M22 16.92v3a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-3" />
                <path d="m6 16-4 4" />
                <path d="m18 16 4 4" />
                <path d="M12 12V2" />
                <path d="M6.5 6.5l5.5-5.5 5.5 5.5" />
              </svg>
              <span class="text-lg font-semibold text-yellow-400"
                >Emergency: +91 90024 50077</span
              >
            </div>
          </div>

          <!-- Col 2: Location & Timings -->
          <div>
            <h4 class="text-xl font-bold text-red-300 mb-4">
              Location & Hours
            </h4>
            <p class="text-red-200 flex items-start space-x-2 mb-2">
              <svg
                class="w-5 h-5 flex-shrink-0"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
                <circle cx="12" cy="10" r="3" />
              </svg>
              <span
                >2nd Floor, Arushi Complex, Near SBI E Corner, Yuri Gagrin Path,
                Muchipara, Durgapur - 713212.</span
              >
            </p>
            <p class="text-red-200 flex items-center space-x-2">
              <svg
                class="w-5 h-5"
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10" />
                <polyline points="12 6 12 12 16 14" />
              </svg>
              <span>Mon - Sat: 9:00 AM - 5:00 PM</span>
            </p>
          </div>

          <!-- Col 3: Quick Links & Contact -->
          <div>
            <h4 class="text-xl font-bold text-red-300 mb-4">Quick Links</h4>
            <ul class="space-y-2">
              <li>
                <a
                  href="#"
                  onclick="navigate('doctors')"
                  class="text-red-200 hover:text-white transition-colors"
                  >Our Doctors</a
                >
              </li>
              <li>
                <a
                  href="#"
                  onclick="navigate('services')"
                  class="text-red-200 hover:text-white transition-colors"
                  >Treatments</a
                >
              </li>
              <li>
                <a
                  href="mailto:info@cardiosphere.in"
                  class="text-red-200 hover:text-white transition-colors"
                  >info@cardiosphere.in</a
                >
              </li>
              <li>
                <a
                  href="https://maps.app.goo.gl/YourMapLinkHere"
                  target="_blank"
                  class="text-red-200 hover:text-white transition-colors"
                  >Get Directions</a
                >
              </li>
            </ul>
          </div>
        </div>

        <div class="mt-8 pt-6 border-t border-red-800 text-center">
          <p class="text-sm text-red-400">
            &copy; 2025 Cardiosphere Polyclinic. All rights reserved.
          </p>
        </div>
      </footer>
    </main>

    <script type="module">
      // --- FIREBASE SETUP ---
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
      import {
        getAuth,
        signInAnonymously,
        signInWithCustomToken,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
      import {
        getFirestore,
        collection,
        doc,
        setDoc,
        serverTimestamp,
        setLogLevel,
      } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

      // IMPORTANT: Global variables are provided by the Canvas environment.
      const appId =
        typeof __app_id !== "undefined" ? __app_id : "default-app-id";
      const firebaseConfig =
        typeof __firebase_config !== "undefined"
          ? JSON.parse(__firebase_config)
          : null;
      const initialAuthToken =
        typeof __initial_auth_token !== "undefined"
          ? __initial_auth_token
          : null;

      // Define the target email address
      const TARGET_EMAIL = "info.cardiosphere@gmail.com";

      let app;
      let db;
      let auth;

      async function initializeFirebase() {
        if (!firebaseConfig) {
          console.error(
            "Firebase config is missing. Firestore features will be unavailable."
          );
          return;
        }

        try {
          setLogLevel("Debug");
          app = initializeApp(firebaseConfig);
          db = getFirestore(app);
          auth = getAuth(app);

          // Sign in using the custom token or anonymously
          if (initialAuthToken) {
            await signInWithCustomToken(auth, initialAuthToken);
            console.log("Firebase signed in with custom token.");
          } else {
            await signInAnonymously(auth);
            console.log("Firebase signed in anonymously.");
          }
        } catch (error) {
          console.error("Error initializing Firebase or signing in:", error);
        }
      }

      // --- APPOINTMENT MODAL LOGIC ---
      const modal = document.getElementById("appointment-modal");
      const form = document.getElementById("appointment-form");
      const submissionMessage = document.getElementById("submission-message");

      window.openModal = function () {
        modal.classList.remove("hidden");
        submissionMessage.classList.add("hidden");
        submissionMessage.textContent = "";
        form.reset();
      };

      window.closeModal = function (event) {
        if (event && event.target === modal) {
          modal.classList.add("hidden");
        } else if (!event) {
          modal.classList.add("hidden");
        }
      };

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const doctor = document.getElementById("doctor").value;
        const name = document.getElementById("name").value;
        const phone = document.getElementById("phone").value;
        const date = document.getElementById("date").value;
        const reason = document.getElementById("reason").value;

        submissionMessage.classList.remove("hidden");
        submissionMessage.classList.remove("text-red-600", "text-green-600");
        submissionMessage.textContent =
          "Processing your appointment request...";

        const appointmentData = {
          doctor: doctor,
          patientName: name,
          phoneNumber: phone,
          preferredDate: date,
          reasonForVisit: reason,
          status: "PENDING",
          timestamp: serverTimestamp(),
        };

        if (!db || !auth.currentUser) {
          // Fallback / Non-Firebase logic: Open mailto link
          console.warn(
            "Firestore not available or user not authenticated. Attempting to open mailto link."
          );

          const subject = `New Appointment Request for ${doctor} at Cardiosphere`;
          const body = `Doctor: ${doctor}\nPatient Name: ${name}\nPhone: ${phone}\nDate: ${date}\nReason: ${reason}\n\n[Please ensure you send this email to confirm your request. You may be contacted by phone for confirmation.]`;
          const mailtoLink = `mailto:${TARGET_EMAIL}?subject=${encodeURIComponent(
            subject
          )}&body=${encodeURIComponent(body)}`;

          submissionMessage.textContent = `ðŸš¨ IMPORTANT: Please check your browser/device for a new email draft and click "Send" to finalize your appointment request to ${TARGET_EMAIL}. We will call you soon on ${phone} for confirmation.`;
          submissionMessage.classList.add("text-red-600");

          // Open the user's email client with pre-filled details
          window.open(mailtoLink, "_blank");

          setTimeout(() => closeModal(), 7000);
          return;
        }

        const userId = auth.currentUser.uid;
        appointmentData.userId = userId;

        const newDocRef = doc(
          collection(db, `artifacts/${appId}/public/data/appointments`)
        );

        try {
          await setDoc(newDocRef, appointmentData);

          // --- Confirmation and Email Notice ---
          submissionMessage.textContent = `Success! Your appointment for ${doctor} on ${date} has been submitted. The details have been forwarded to the clinic at ${TARGET_EMAIL}. We will call you soon to confirm the exact time.`;

          console.log(
            `[FIRESTORE LOGGED] Appointment ID: ${newDocRef.id}. Details forwarded to ${TARGET_EMAIL}.`
          );

          submissionMessage.classList.add("text-green-600"); // Use green for success messages
          form.reset();
          setTimeout(() => closeModal(), 5000);
        } catch (error) {
          console.error("Error submitting appointment:", error);
          submissionMessage.textContent =
            "Failed to book appointment. Please try again or call us directly.";
          submissionMessage.classList.add("text-red-600");
        }
      });

      // --- NAVIGATION LOGIC ---
      const sections = document.querySelectorAll("main > section");
      const mobileMenu = document.getElementById("mobile-menu");
      const mobileMenuButton = document.getElementById("mobile-menu-button");

      window.navigate = function (targetId) {
        sections.forEach((section) => {
          section.style.display = "none";
        });
        document.getElementById(targetId).style.display = "block";
        window.scrollTo({ top: 0, behavior: "smooth" });
      };

      window.toggleMobileMenu = function () {
        mobileMenu.classList.toggle("hidden");
      };

      mobileMenuButton.addEventListener("click", window.toggleMobileMenu);

      // --- INITIALIZATION ---
      window.onload = function () {
        initializeFirebase();

        // Set initial navigation to home
        navigate("home");
      };
    </script>
  </body>
</html>
